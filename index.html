<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>íˆë¼ê°€ë‚˜ í€´ì¦ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #111;
      transition: background 0.3s, color 0.3s;
    }

    /* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ */
    body.dark {
      background: #1e1e1e;
      color: #e5e5e5;
    }
    body.dark .question-card,
    body.dark .choice-item,
    body.dark .chip,
    body.dark .submit {
      background: #2c2c2c;
      color: #f0f0f0;
      border-color: #555;
    }
    body.dark .chip.active {
      background: #007aff;
      border-color: #007aff;
      color: #fff;
    }
    body.dark .feedback.correct {
      background: #233c25;
      border-color: #4caf50;
    }
    body.dark .feedback.wrong {
      background: #402626;
      border-color: #ef5350;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin: 0 0 12px 0;
    }

    /* ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
    .dark-toggle {
      display: flex;
      justify-content: center;
      margin-bottom: 12px;
    }
    .dark-toggle button {
      padding: 6px 12px;
      border-radius: 8px;
      border: none;
      background: #007aff;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 8px 0 4px 0;
    }

    .direction-bar,
    .group-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .chip {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #fff;
      font-size: 13px;
      cursor: pointer;
    }

    .chip.active {
      background: #007aff;
      border-color: #007aff;
      color: #fff;
    }

    .score-panel {
      text-align: center;
      font-size: 13px;
      color: inherit;
      margin: 8px 0;
    }

    .feedback {
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 6px;
      font-size: 14px;
    }

    .feedback.correct {
      background: #f6ffed;
      border: 1px solid #b7eb8f;
    }

    .feedback.wrong {
      background: #fff1f0;
      border: 1px solid #ffa39e;
    }

    .question-card {
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      margin: 8px 0;
      text-align: center;
      border: 1px solid #ddd;
    }

    .question-title {
      font-size: 14px;
      margin-bottom: 4px;
    }

    .question-main {
      font-size: 32px;
      margin: 0;
    }

    .choices {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 8px 0 12px 0;
    }

    .choice-item {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fff;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .choice-item input[type="radio"] {
      transform: scale(1.2);
    }

    button.submit {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      background: #007aff;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }

    button.submit:active { opacity: 0.8; }

  </style>
</head>

<body>
<div class="app">
  <h1>íˆë¼ê°€ë‚˜ í€´ì¦ˆ</h1>

  <!-- ğŸŒ™ ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
  <div class="dark-toggle">
    <button id="darkModeBtn">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
  </div>

  <section>
    <div class="section-title">ë¬¸ì œ ë°©í–¥</div>
    <div class="direction-bar" id="direction-bar">
      <button class="chip" data-direction="ko_to_hi">í•œê¸€ â†’ íˆë¼ê°€ë‚˜</button>
      <button class="chip" data-direction="hi_to_ko">íˆë¼ê°€ë‚˜ â†’ í•œê¸€</button>
    </div>
  </section>

  <section>
    <div class="section-title">ì¶œì œí•  í–‰ ì„ íƒ</div>
    <div class="group-bar" id="group-bar"></div>
    <div class="group-bar">
      <button class="chip" id="btn-select-all">ì „ì²´ ì„ íƒ</button>
    </div>
  </section>

  <section>
    <div class="score-panel" id="score-panel">ì•„ì§ í‘¼ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    <div id="feedback-container"></div>

    <div class="question-card">
      <div class="question-title" id="question-title"></div>
      <p class="question-main" id="question-main"></p>
    </div>

    <form id="quiz-form">
      <div class="choices" id="choices-container"></div>
      <button type="submit" class="submit">ì œì¶œ</button>
    </form>
  </section>
</div>

<script type="module">

  /* ========== ğŸŒ™ ë‹¤í¬ëª¨ë“œ ê¸°ëŠ¥ ========== */
  const darkModeBtn = document.getElementById("darkModeBtn");

  // ì €ì¥ëœ ëª¨ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
  let savedTheme = localStorage.getItem("theme");
  if (savedTheme === "dark") {
    document.body.classList.add("dark");
    darkModeBtn.textContent = "â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ";
  }

  darkModeBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark");

    if (document.body.classList.contains("dark")) {
      localStorage.setItem("theme", "dark");
      darkModeBtn.textContent = "â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ";
    } else {
      localStorage.setItem("theme", "light");
      darkModeBtn.textContent = "ğŸŒ™ ë‹¤í¬ëª¨ë“œ";
    }
  });

  /* ============================ ê¸°ì¡´ JS ì½”ë“œ (v0.1 ê¸°ëŠ¥ ìœ ì§€) ============================ */

  const DIRECTION = {
    KO_TO_HI: "ko_to_hi",
    HI_TO_KO: "hi_to_ko",
  };

  const GROUPS = {
    A:  { id: "a", label: "ì•„í–‰" },
    KA: { id: "ka", label: "ì¹´í–‰" },
    SA: { id: "sa", label: "ì‚¬í–‰" },
    TA: { id: "ta", label: "íƒ€í–‰" },
    NA: { id: "na", label: "ë‚˜í–‰" },
    HA: { id: "ha", label: "í•˜í–‰" },
    MA: { id: "ma", label: "ë§ˆí–‰" },
    YA: { id: "ya", label: "ì•¼í–‰" },
    RA: { id: "ra", label: "ë¼í–‰" },
    WA: { id: "wa", label: "ì™€/íŠ¹ìˆ˜" },
  };

  const HIRAGANA_LIST = [
    { ko: "ì•„", hi: "ã‚", group: "a" },
    { ko: "ì´", hi: "ã„", group: "a" },
    { ko: "ìš°", hi: "ã†", group: "a" },
    { ko: "ì—", hi: "ãˆ", group: "a" },
    { ko: "ì˜¤", hi: "ãŠ", group: "a" },

    { ko: "ì¹´", hi: "ã‹", group: "ka" },
    { ko: "í‚¤", hi: "ã", group: "ka" },
    { ko: "ì¿ ", hi: "ã", group: "ka" },
    { ko: "ì¼€", hi: "ã‘", group: "ka" },
    { ko: "ì½”", hi: "ã“", group: "ka" },

    { ko: "ì‚¬", hi: "ã•", group: "sa" },
    { ko: "ì‹œ", hi: "ã—", group: "sa" },
    { ko: "ìŠ¤", hi: "ã™", group: "sa" },
    { ko: "ì„¸", hi: "ã›", group: "sa" },
    { ko: "ì†Œ", hi: "ã", group: "sa" },

    { ko: "íƒ€", hi: "ãŸ", group: "ta" },
    { ko: "ì¹˜", hi: "ã¡", group: "ta" },
    { ko: "ì¸ ", hi: "ã¤", group: "ta" },
    { ko: "í…Œ", hi: "ã¦", group: "ta" },
    { ko: "í† ", hi: "ã¨", group: "ta" },

    { ko: "ë‚˜", hi: "ãª", group: "na" },
    { ko: "ë‹ˆ", hi: "ã«", group: "na" },
    { ko: "ëˆ„", hi: "ã¬", group: "na" },
    { ko: "ë„¤", hi: "ã­", group: "na" },
    { ko: "ë…¸", hi: "ã®", group: "na" },

    { ko: "í•˜", hi: "ã¯", group: "ha" },
    { ko: "íˆ", hi: "ã²", group: "ha" },
    { ko: "í›„", hi: "ãµ", group: "ha" },
    { ko: "í—¤", hi: "ã¸", group: "ha" },
    { ko: "í˜¸", hi: "ã»", group: "ha" },

    { ko: "ë§ˆ", hi: "ã¾", group: "ma" },
    { ko: "ë¯¸", hi: "ã¿", group: "ma" },
    { ko: "ë¬´", hi: "ã‚€", group: "ma" },
    { ko: "ë©”", hi: "ã‚", group: "ma" },
    { ko: "ëª¨", hi: "ã‚‚", group: "ma" },

    { ko: "ì•¼", hi: "ã‚„", group: "ya" },
    { ko: "ìœ ", hi: "ã‚†", group: "ya" },
    { ko: "ìš”", hi: "ã‚ˆ", group: "ya" },

    { ko: "ë¼", hi: "ã‚‰", group: "ra" },
    { ko: "ë¦¬", hi: "ã‚Š", group: "ra" },
    { ko: "ë£¨", hi: "ã‚‹", group: "ra" },
    { ko: "ë ˆ", hi: "ã‚Œ", group: "ra" },
    { ko: "ë¡œ", hi: "ã‚", group: "ra" },

    { ko: "ì™€", hi: "ã‚", group: "wa" },
    { ko: "ì˜¤(ë¥¼)", hi: "ã‚’", group: "wa" },
    { ko: "ì‘", hi: "ã‚“", group: "wa" },
  ];

  const ALL_GROUP_IDS = Object.values(GROUPS).map(g => g.id);
  const CHOICE_COUNT = 4;

  let currentDirection = DIRECTION.KO_TO_HI;
  let enabledGroups = new Set();
  let score = 0;
  let total = 0;
  let lastFeedback = null;
  let currentQuestion = null;

  const directionBarEl = document.getElementById("direction-bar");
  const groupBarEl = document.getElementById("group-bar");
  const selectAllBtnEl = document.getElementById("btn-select-all");
  const scorePanelEl = document.getElementById("score-panel");
  const feedbackContainerEl = document.getElementById("feedback-container");
  const questionTitleEl = document.getElementById("question-title");
  const questionMainEl = document.getElementById("question-main");
  const choicesContainerEl = document.getElementById("choices-container");
  const quizFormEl = document.getElementById("quiz-form");

  function randomChoice(array) {
    return array[Math.floor(Math.random() * array.length)];
  }

  function shuffle(array) {
    return array.map(v => ({ v, r: Math.random() }))
      .sort((a, b) => a.r - b.r)
      .map(x => x.v);
  }

  function getCurrentPool() {
    const groups = Array.from(enabledGroups);
    return HIRAGANA_LIST.filter(i => groups.includes(i.group));
  }

  function renderDirectionButtons() {
    const buttons = directionBarEl.querySelectorAll(".chip");
    buttons.forEach(btn => {
      const dir = btn.dataset.direction;
      btn.classList.toggle("active", dir === currentDirection);
    });
  }

  function renderGroupButtons() {
    groupBarEl.innerHTML = "";

    Object.values(GROUPS).forEach(group => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "chip";
      btn.textContent = group.label;
      btn.dataset.groupId = group.id;

      if (enabledGroups.has(group.id)) btn.classList.add("active");

      btn.addEventListener("click", () => toggleGroup(group.id));
      groupBarEl.appendChild(btn);
    });
  }

  function renderScore() {
    if (total === 0) {
      scorePanelEl.textContent = "ì•„ì§ í‘¼ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.";
      return;
    }
    const rate = ((score / total) * 100).toFixed(1);
    scorePanelEl.textContent = `ì ìˆ˜: ${score} / ${total} (ì •ë‹µë¥ : ${rate}%)`;
  }

  function renderFeedback() {
    feedbackContainerEl.innerHTML = "";
    if (!lastFeedback) return;

    const div = document.createElement("div");
    div.className = "feedback " + (lastFeedback.ok ? "correct" : "wrong");
    div.textContent = lastFeedback.message;
    feedbackContainerEl.appendChild(div);
  }

  function renderQuestion() {
    if (!currentQuestion) {
      questionTitleEl.textContent = "ì¶œì œí•  í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.";
      questionMainEl.textContent = "";
      choicesContainerEl.innerHTML = "";
      return;
    }

    questionTitleEl.textContent =
      currentDirection === DIRECTION.KO_TO_HI
        ? "ë‹¤ìŒ í•œê¸€ì— í•´ë‹¹í•˜ëŠ” íˆë¼ê°€ë‚˜ëŠ”?"
        : "ë‹¤ìŒ íˆë¼ê°€ë‚˜ì— í•´ë‹¹í•˜ëŠ” í•œêµ­ì–´ ë°œìŒì€?";

    questionMainEl.textContent = currentQuestion.question;

    choicesContainerEl.innerHTML = "";
    currentQuestion.choices.forEach(choice => {
      const label = document.createElement("label");
      label.className = "choice-item";

      const input = document.createElement("input");
      input.type = "radio";
      input.name = "choice";
      input.value = choice;

      const span = document.createElement("span");
      span.textContent = choice;

      label.appendChild(input);
      label.appendChild(span);
      choicesContainerEl.appendChild(label);
    });
  }

  function generateQuestion() {
    const pool = getCurrentPool();
    if (pool.length === 0) return null;

    const picked = randomChoice(pool);
    let questionText, answerText, optionsPool;

    if (currentDirection === DIRECTION.KO_TO_HI) {
      questionText = picked.ko;
      answerText = picked.hi;
      optionsPool = pool.map(i => i.hi);
    } else {
      questionText = picked.hi;
      answerText = picked.ko;
      optionsPool = pool.map(i => i.ko);
    }

    const wrongOptions = shuffle(
      optionsPool.filter(v => v !== answerText)
    ).slice(0, CHOICE_COUNT - 1);

    const choices = shuffle([answerText, ...wrongOptions]);

    return { question: questionText, answer: answerText, choices };
  }

  function loadNewQuestion() {
    currentQuestion = generateQuestion();
    renderQuestion();
  }

  function toggleGroup(groupId) {
    if (enabledGroups.has(groupId)) {
      enabledGroups.delete(groupId);
    } else {
      enabledGroups.add(groupId);
    }
    renderGroupButtons();
    loadNewQuestion();
  }

  directionBarEl.addEventListener("click", (event) => {
    const target = event.target.closest(".chip");
    if (!target) return;

    currentDirection = target.dataset.direction;
    renderDirectionButtons();
    loadNewQuestion();
  });

  selectAllBtnEl.addEventListener("click", () => {
    const allSelected = ALL_GROUP_IDS.every(id => enabledGroups.has(id));

    enabledGroups = allSelected ? new Set() : new Set(ALL_GROUP_IDS);

    renderGroupButtons();
    loadNewQuestion();
  });

  quizFormEl.addEventListener("submit", (event) => {
    event.preventDefault();
    if (!currentQuestion) return;

    const checked = quizFormEl.querySelector("input[name='choice']:checked");
    if (!checked) {
      alert("ë³´ê¸° í•˜ë‚˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    const selected = checked.value;
    const correct = currentQuestion.answer;

    total += 1;
    if (selected === correct) {
      score += 1;
      lastFeedback = { ok: true, message: "ì •ë‹µì…ë‹ˆë‹¤! âœ…" };
    } else {
      lastFeedback = {
        ok: false,
        message: `ì˜¤ë‹µì…ë‹ˆë‹¤. âŒ ì •ë‹µì€ '${correct}' ì…ë‹ˆë‹¤.`,
      };
    }

    renderScore();
    renderFeedback();
    loadNewQuestion();
  });

  function init() {
    renderDirectionButtons();
    renderGroupButtons();
    renderScore();
    loadNewQuestion();
  }

  init();

</script>
</body>
</html>

